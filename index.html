<link rel="stylesheet" href="https://unpkg.com/treeflex/dist/css/treeflex.css">
<script src="https://cdn.jsdelivr.net/npm/enhance-object-property-names-getters"></script>
<script>
    (function(){
        function main(start) {
            function cb(path) {
                let node = root;
                for (let i =  0; i < path.length; i++) {
                    const val = path[i];
                    const prop = (val+'').split('[object ').join('').split(']').join('');
                    if (!node[prop]) {
                        node[prop] = path.length - 1 === i ? null : {value: val};
                    }
                    node = node[prop];
                }
            }

            const root = {};
            const props = Object.getAllPropertyNames(start);
            for (let i = 0; i < props.length; i++) {
                const prop = props[i];
                let obj = start[prop];
                const protos = [obj];
                while (true) {
                    if (!obj) break;
                    const proto = Object.getPrototypeOf(obj);
                    if (!proto) break;
                    protos.push(proto);
                    obj = proto;
                }
                protos.reverse();
                cb(protos);
            }
            return root;
        }

        let id = 0;

        function tree(node, obj, filter) {
            if (!obj) {
                if (!node.parentElement.querySelector('[found="true"]')) {
                    node.parentElement.remove();
                }
            }
            for (const prop in obj) {
                if (prop === 'value') continue;
                const val = obj[prop];
                id += 1;
                const includes = prop.includes(filter);
                node.innerHTML += `<li><span found="${includes}" class="tf-nc">${prop}</span><ul id="${'a' + id}"></ul></li>`;
                tree(node.querySelector('#' + 'a' + id), val, filter, includes);
            }
            if (!node.parentElement?.querySelector('[found="true"]')) {
                node.parentElement?.remove();
            }
        }

        setTimeout(function(){
            const root = main(window);
            console.log(root);
            // const treed = treeify.asTree(tree);
            // console.log(treed);
            // for (const p in root['Object']) {
            //     if (p === 'EventTarget') continue
            //     delete root['Object'][p];
            // }
            debugger;
            const filter = location.href.split('?')[1];
            const e = document.createElement('ul');
            tree(e, root, filter);
            head.appendChild(e);
        });
    }())
</script>
<body>
    <div id="head" class="tf-tree"></div>
</body>