<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1379968351324902" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/treeflex@2.0.1/dist/css/treeflex.css">
    <script src="https://cdn.jsdelivr.net/npm/enhance-object-property-names-getters"></script>
    <script src="https://cdn.jsdelivr.net/npm/treeify@1.1.0/treeify.js"></script>
    <style>
        h3 {
            font-size: 16px;
        }
        ul,li {
            font-size: 12px !important;
        }
        #menu {
            padding-left: 5px;
            font-size: 12px !important;
            width: 70%;
        }
        #head {
            padding: 10px;
            margin: 5px;
            float: left;
            height: 50%;
        }
        #head2 {
            padding: 20px;
            margin: 20px;
            overflow: hidden;
        }
        #start {
            height: 40%;
            border-style: solid;
            margin: 20px;
            padding: 20px;
        }
    </style>
    <script>
        (function () {
            function isPrimitive(v) {
                if (null === v || undefined === v) {
                    return true;
                }
                if (['boolean', 'number', 'string'].includes(typeof v)) {
                    // return true;
                }
                return false;
            }

            // because of adsense
            function isFrame(v) {
                let i = 0;
                let w;
                while (w) {
                    w = top[i];
                    if (v === w) {
                        return true;
                    }
                    i++;
                }
            }

            const values = {};

            function main(start) {
                function getProp(val) {
                    switch (val) {
                        case Number.prototype:
                            return 'Number';
                        case Array.prototype:
                            return 'Array';
                        case Boolean.prototype:
                            return 'Boolean';
                        case String.prototype:
                            return 'String';
                        default:
                            return (val + '').split('[object ').join('').split(']').join('');
                    }
                }

                function cb(path) {
                    let node = root;
                    for (let i = 0; i < path.length; i++) {
                        const val = path[i];
                        const prop = getProp(val);
                        if (!node[prop]) {
                            id += 1;
                            values['b' + id] = val;
                            node[prop] = path.length - 1 === i ? null : {_value_reference: 'vf' + id};
                        }
                        node = node[prop];
                    }
                }

                const root = {};
                const props = Object.getAllPropertyNames(start);
                for (let i = 0; i < props.length; i++) {
                    const prop = props[i];
                    let obj = start[prop];
                    if (isPrimitive(obj) || isFrame(obj)) continue;
                    const protos = [obj];
                    while (true) {
                        if (isPrimitive(obj) || isFrame(obj)) break;
                        const proto = Object.getPrototypeOf(obj);
                        if (!proto) break;
                        protos.push(proto);
                        obj = proto;
                    }
                    protos.reverse();
                    cb(protos);
                }
                return root;
            }

            function includes(opts, prop) {
                // ignore filters query param
                if (prop.includes('filters=')) {
                    return false;
                }
                prop = prop.split('filters=')[0].toLowerCase();
                // ignore adsense stuff
                if (prop.startsWith('__') || prop.includes('google')) {
                    return false;
                }
                if (!opts.filters.length) return true;
                for (const filter of opts.filters) {
                    let found = false;
                    if (prop.includes(filter.filter.toLowerCase())) {
                        found = true;
                    }
                    if (filter.not) {
                        found = !found;
                    }
                    if (found) {
                        return true;
                    }
                }
                return false;
            }

            let id = 0;

            function tree(node, obj, opts) {
                if (!obj) {
                    if (!node.parentElement.querySelector('[found="true"]')) {
                        node.parentElement.remove();
                    }
                }
                for (const prop in obj) {
                    if (prop === '_value_reference') continue;
                    const val = obj[prop];
                    id += 1;
                    node.innerHTML += `<li><span found="${includes(opts, prop, obj.value)}" class="tf-nc">${prop}</span><ul id="${'id' + id}"></ul></li>`;
                    tree(node.querySelector('#' + 'id' + id), val, opts);
                }
                if (!node.parentElement?.querySelector('[found="true"]')) {
                    node.parentElement?.remove();
                }
            }

            function opts(queryString) {
                const opts = {filters: []};
                const urlParams = new URLSearchParams(queryString);
                const filters = urlParams.get('filters');
                if (!filters) return opts;
                for (const filter of filters.split(',')) {
                    const f = { not: false, filter };
                    if (filter[0] === '!') {
                        f.not = true;
                        f.filter = filter.split('!').join('');
                    }
                    opts.filters.push(f);
                }
                return opts;
            }

            function getLayers(start) {
                const layers = {
                    1: [],
                    2: [],
                    3: [],
                    4: [],
                    5: [],
                    6: [],
                    7: [],
                    8: [],
                    9: [],
                    10: [],
                    11: [],
                    12: [],
                }
                const spans = start.querySelectorAll('span');
                for (let i = 0; i < spans.length; i++) {
                    const span = spans[i];
                    let d = -1, s = span;
                    while (s !== start) {
                        d += 1;
                        s = s.parentElement;
                    }
                    layers[d/2].push(span);
                }
                return layers;
            }

            function prepareMenu(menu, layers, maxLevels = 12, maxItems = 10) {
                const div = document.createElement('div');
                for (const level in layers) {
                    const layer = layers[level];
                    if (!--maxLevels) break;
                    if (layer.length > maxItems) continue;
                    for (let i = 0; i < layer.length; i++) {
                        const span = layer[i];
                        const a = document.createElement('a');
                        a.textContent = span.textContent;
                        a.href = 'javascript:;';
                        a.onclick = () => span.scrollIntoView({behavior: 'smooth'})
                        div.appendChild(a);
                        div.append(' | ');
                        if (div.children.length % 9 === 0) {
                            div.appendChild(document.createElement('br'));
                        }
                    }
                }
                div.lastChild?.remove();
                menu.appendChild(div);
            }

            setTimeout(function () {
                const root = main(window);
                console.log('%cüëÄ Observe full live tree representing the full prototype chain:', 'color:deepskyblue');
                console.log(root);
                console.log('%cüó∫Ô∏è Map each entry in the full tree above to its real actual object in runtime:', 'color:deepskyblue');
                console.log(values);
                console.log('%cüëÄ Observe the full tree visually', 'color:deepskyblue');
                console.log(treeify.asTree(root));
                console.log('%cüëÜüèª Begin at the top of the console üëÜüèª', 'color:deepskyblue');
                const e = document.createElement('ul');
                tree(e, root, opts(window.location.search));
                start.appendChild(e);
                start.setAttribute('class', 'tf-tree');
                const layers = getLayers(start);
                prepareMenu(menu, layers, 6, 30);
            });
        }())
    </script>
</head>
<body>
    <div style="overflow: hidden;">
        <div id="head">
            <h3>The Prototype Chain ‚õìÔ∏è</h3>
            <div id="info">
                <ul>
                    <li>
                        Here you can observe the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">prototype chain</a> generated in your browser, presented as a tree
                        <ul>
                            <li>
                                The tree can vary depending on:
                                <ul>
                                    <li>
                                        The current browser you use
                                    </li>
                                    <li>
                                        Any extensions and plugins you use
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <b>
                                    NOTICE: This list is generated by climbing up the global object (aka <code>window</code>) and
                                    therefore is not complete because there are <br> prototypes that are inaccessible via the global object
                                    and are only accessible as return values from different objects and APIs
                                </b>
                                <ul>
                                    <li>
                                        Suggestions for such are welcome to enhance this list to cover as much as possible!
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        Further information is presented in the console, make sure to check that out too
                    </li>
                </ul>
            </div>
            <h3>Filters ‚öôÔ∏è</h3>
            <ul>
                <li>
                    Since the full tree is overwhelming, you can use filters by adding the <code>filters</code> query param
                    <ul>
                        <li>
                            Multiple filters can be separated by using <code>","</code>
                        </li>
                        <li>
                            To achieve negative effect ("everything but") use <code>"!"</code> at the beginning of the filter
                        </li>
                    </ul>
                    <ul>
                        <li>
                            Here are some examples:
                            <a href="?filters=XMLHttp">XMLHttp</a> |
                            <a href="?filters=!function">!function</a> |
                            <a href="?filters=Bool,Document">Bool,Document</a> |
                            <input placeholder="insert filter" id="input"
                                   onblur="var searchParams = new URLSearchParams(window.location.search);searchParams.set('filters', input.value);window.location.search = searchParams.toString();"
                            >
                        </li>
                    </ul>
                </li>
            </ul>
            <h3>Shortcuts üéØ</h3>
            <div id="menu"></div>
        </div>
        <div id="head2">
            <!-- test-1 -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1379968351324902"
                 data-ad-slot="4374038862"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                window.orientation > -1 || (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        <script>
            input.value = new URLSearchParams(window.location.search).get('filters');
        </script>
    </div>
    <div id="start"></div>
    <div style="padding-left: 10px"> <i>~ Made with ‚ù§Ô∏è By <a href="https://weizman.github.io/page-about">Gal Weizman</a></i> </div>
</body>
</html>