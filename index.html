<html>
<head>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå≥Ô∏è</text></svg>">
    <title>Proto Tree</title>
    <meta name="author" content="Gal Weizman">
    <meta property="og:type" name="type" content="article">
    <meta property="og:site_name" content="Proto Tree">
    <meta property="og:image" name="image" content="https://prototree.github.io/meta/img.jpg"/>
    <meta property="og:description" name="description"
          content="Observe the javascript prototype chain as an interactive tree in the browser"/>
    <meta property="og:title" name="name" content="ProtoTree - the javascript prototype chain as a tree"/>
    <meta property="og:image:type" content="meta/img.jpg">
    <meta property="og:image:width" content="440"/>
    <meta property="og:image:height" content="440"/>

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@weizman">
    <meta name="twitter:creator" content="@weizman">
    <meta name="twitter:title" content="ProtoTree - the javascript prototype chain as a tree"/>
    <meta name="twitter:description"
          content="Observe the javascript prototype chain as an interactive tree in the browser"/>
    <meta name="twitter:image:src" content="https://prototree.github.io/meta/img.jpg"/>

    <meta name="apple-mobile-web-app-title" content="ProtoTree - the javascript prototype chain as a tree">
    <meta name="application-name" content="ProtoTree - the javascript prototype chain as a tree">

    <meta property="forem:name" content="Proto Tree">
    <meta property="forem:logo"
          content="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå≥Ô∏è</text></svg>">
    <meta property="forem:domain" content="prototree.github.io">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <meta name="description" content="Observe the javascript prototype chain as an interactive tree in the browser">
    <meta name="keywords" content="prototype, chain, tree, javascript, browser">

    <meta name="last-updated" content="2023-02-01 19:33:05 UTC">
    <meta name="user-signed-in" content="false">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1379968351324902"
            crossOrigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
          integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossOrigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/treeflex@2.0.1/dist/css/treeflex.css">
    <script src="https://cdn.jsdelivr.net/npm/treeify@1.1.0/treeify.js"></script>
    <style>
        #btn {
            padding: 5px;
            border-radius: 20px;
        }

        a {
            color: green;
        }

        a.ofstart {
            color: black;
        }

        body {
            background-color: rgb(231, 255, 212);
        }

        .function {
            color: green;
        }

        code {
            color: green;
        }

        h2 {
            font-size: 22px;
        }

        h3 {
            font-size: 16px;
        }

        ul, li {
            font-size: 12px !important;
        }

        #menu {
            padding-left: 5px;
            font-size: 12px !important;
            width: 70vh;
        }

        #head {
            padding: 10px;
            margin: 5px;
            float: left;
            height: 50%;
        }

        #head2 {
            padding: 20px;
            margin: 20px;
            overflow: hidden;
        }

        #start {
            resize: vertical;
            overflow: auto;
            border-radius: 20px;
            background-color: rgb(220, 250, 194);
            height: 37%;
            border-style: solid;
            margin: 20px;
            padding: 10px;
        }
    </style>
</head>
<body>
<div style="overflow: hidden;">
    <div id="head">
        <h3 id="notice" style="display: none; color: red">This app makes more sense on desktop rather than mobile
            devices!</h3>
        <h2>
            <a href="https://github.com/prototree">Proto Tree üå≥</a>
            <a style="font-size: 14px"
               href="javascript:localStorage.full_screen = !JSON.parse(localStorage.full_screen);location.reload();">
                <u><i>
                    ( full screen
                    <iframe onLoad="localStorage.full_screen = localStorage.full_screen || 'false';this.parentElement.append(JSON.parse(localStorage.full_screen) ? 'on' : 'off');this.remove();"></iframe>
                    )
                </i></u>
            </a>
        </h2>
        <div id="info">
            <h3>The Prototype Chain ‚õìÔ∏è</h3>
            <ul>
                <li>
                    Here you can observe the <a
                        href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">prototype
                    chain</a> generated <b>in your browser</b>, presented as a tree üå≥
                    <ul>
                        <li>
                            The tree can vary depending on:
                            <ul>
                                <li>
                                    The current browser you use
                                </li>
                                <li>
                                    Any extensions and plugins you use
                                </li>
                            </ul>
                        </li>
                        <li>
                            <b> NOTICE: </b> This list is generated by climbing up the global object (aka
                            <code>window</code>) and
                            therefore <b>is not complete</b> because there are <br> prototypes that are inaccessible via the
                            global object
                            and are only accessible as return values from different objects and APIs
                            <ul>
                                <li>
                                    Suggestions for such <a
                                        href="https://github.com/ProtoTree/ProtoTree.github.io/issues/2">are welcome</a>
                                    to enhance this list to cover <b>as much as possible!</b>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Further information is presented in the console, <b>make sure</b> to check that out too
                </li>
            </ul>

            <h3>Filters ‚öôÔ∏è</h3>
            <ul>
                <li>
                    Since the full tree is <b>overwhelming</b>, you can use filters by adding the <code>filters</code> query
                    param
                    <ul>
                        <li>
                            Multiple filters can be separated by using <code>","</code>
                        </li>
                        <li>
                            To achieve negative effect ("everything but") use <code>"!"</code> at the beginning of the
                            filter
                        </li>
                    </ul>
                    <ul>
                        <li>
                            Here are some examples:
                            <a href="?filters=XMLHttp">XMLHttp</a> |
                            <a href="?filters=!function">!function</a> |
                            <a href="?filters=Bool,Document">Bool,Document</a> |
                            <input style="width: 200px" placeholder="insert filter" id="input"
                                   onblur="var searchParams = new URLSearchParams(window.location.search);searchParams.set('filters', input.value);window.location.search = searchParams.toString();"
                            >
                        </li>
                    </ul>
                </li>
            </ul>
            <h3>Shortcuts üéØ</h3>
            <div id="menu"></div>
        </div>
    </div>
    <div id="head2">
        <!-- ad1 -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1379968351324902"
             data-ad-slot="3441937435"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
            setTimeout(() => window.orientation > -1 || (adsbygoogle = window.adsbygoogle || []).push({}));
            window.orientation > -1 && (notice.style.display = 'block');
            window.orientation > -1 && (info.style.display = 'none');
            window.orientation > -1 && (head2.style.display = 'none');
            window.orientation > -1 && (head.style.height = '20%');
        </script>
    </div>
    <script>
        input.value = new URLSearchParams(window.location.search).get('filters');
    </script>
</div>
<div id="start">
    <div style="padding-top: 50px; font-size: 50px; color: green">
        <marquee scrollamount="10" direction="right">
            ‚è≥
        </marquee>
    </div>
</div>
<div style="padding-left: 10px">
    <div>
        <div style="white-space: nowrap" id="props"></div>
        <i>
            ~ Made with ‚ù§Ô∏è By <a href="https://weizman.github.io/page-about">Gal Weizman</a> |
            Runs on
            <a href="https://www.npmjs.com/package/@lavamoat/lavatube">LavaTube üåã</a> ,
            <a href="https://www.npmjs.com/package/treeify">treeify@1.1.0</a> ,
            <a href="https://www.npmjs.com/package/treeflex">treeflex@2.0.1</a> ,
            <a href="https://www.npmjs.com/package/bootstrap">bootstrap@3.4.1</a>
        </i>
    </div>
</div>
<script>
    const ownNames = {};
    function setOwns(span) {
        props.innerHTML = '<p><b>Own Property Names:</b> ' + ownNames[span.id] + '</p>';
    }

    onmessage = function (data) {
        let id = 0;

        function tree(node, obj, opts) {
            if (!obj) {
                if (!node.parentElement.querySelector('[found="true"]')) {
                    node.parentElement.remove();
                }
            }
            for (const prop in obj) {
                if (prop === '_value_reference' || prop === '_own_names') continue;
                const val = obj[prop];
                id += 1;
                ownNames[val._value_reference] = val._own_names.join(', ');
                node.innerHTML += `<li><span onmouseover="setOwns(this)" id="${val._value_reference}" found="${includes(opts, prop, obj.value)}" class="tf-nc">${prop}</span><ul id="${'id' + id}"></ul></li>`;
                tree(node.querySelector('#' + 'id' + id), val, opts);
            }
            if (!node.parentElement?.querySelector('[found="true"]')) {
                node.parentElement?.remove();
            }
        }

        function opts(queryString) {
            const opts = {filters: []};
            const urlParams = new URLSearchParams(queryString);
            const filters = urlParams.get('filters');
            if (!filters) return opts;
            for (const filter of filters.split(',')) {
                const f = {not: false, filter};
                if (filter[0] === '!') {
                    f.not = true;
                    f.filter = filter.split('!').join('');
                }
                opts.filters.push(f);
            }
            return opts;
        }

        function getLayers(start) {
            const layers = {
                1: [],
                2: [],
                3: [],
                4: [],
                5: [],
                6: [],
                7: [],
                8: [],
                9: [],
                10: [],
                11: [],
                12: [],
            }
            const spans = start.querySelectorAll('span');
            for (let i = 0; i < spans.length; i++) {
                const span = spans[i];
                let d = -1, s = span;
                while (s !== start) {
                    d += 1;
                    s = s.parentElement;
                }
                layers[d / 2].push(span);
            }
            return layers;
        }

        function prepareMenu(menu, layers, maxLevels = 12, maxItems = 10) {
            const div = document.createElement('div');
            const x = document.createElement('input');
            x.placeholder = 'jump to';
            x.onchange = () => shortcut(x.value);
            div.appendChild(x);
            div.append(' | ');
            for (const level in layers) {
                const layer = layers[level];
                if (!--maxLevels) break;
                if (layer.length > maxItems) continue;
                for (let i = 0; i < layer.length; i++) {
                    const span = layer[i];
                    const a = document.createElement('a');
                    a.textContent = span.textContent;
                    a.href = 'javascript:;';
                    a.onclick = () => span.scrollIntoView({behavior: 'smooth'})
                    div.appendChild(a);
                    div.append(' | ');
                }
            }
            div.lastChild?.remove();
            menu.appendChild(div);
        }

        function includes(opts, prop) {
            // ignore filters query param
            if (prop.includes('filters=')) {
                return false;
            }
            prop = prop.split('filters=')[0].toLowerCase();
            // ignore adsense stuff
            if (
                prop.startsWith('__') ||
                prop.includes('google') ||
                prop.includes('amp') ||
                prop.includes('ggeac') ||
                prop.includes('default_')
            ) {
                return false;
            }
            if (!opts.filters.length) return true;
            for (const filter of opts.filters) {
                let found = false;
                if (prop.includes(filter.filter.toLowerCase())) {
                    found = true;
                }
                if (filter.not) {
                    found = !found;
                }
                if (found) {
                    return true;
                }
            }
            return false;
        }

        function toJson(head, obj) {
            for (const child of head.children) {
                const span = child.firstChild;
                const prop = span?.firstChild?.textContent;
                if (prop) {
                    obj[prop] = {};
                    toJson(child.lastChild, obj[prop]);
                }
            }
        }

        function getButtonInners() {
            return `
<button id="btn" onclick="navigator.clipboard.writeText(JSON.stringify(top.json));">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
        <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
        <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
    </svg>
</button>
`;
        }

        function shortcut(text) {
            const xpath = `//a[contains(text(),"${text}")][@class="ofstart"]`;
            const matchingElement = document.evaluate(xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
            if (matchingElement?.parentElement) {
                setTimeout(() =>
                        matchingElement?.parentElement.scrollIntoView({behavior: 'smooth'}),
                    0);
            }
        }

        if (!data.data.result) return;
        const root = top.root = JSON.parse(data.data.result);
        const json = top.json = {};
        const e = document.createElement('ul');
        tree(e, root, opts(window.location.search));
        e.querySelectorAll('ul:not(:has(*))').forEach(ul => ul.remove())
        toJson(e, json);
        console.log('%cüëÄ Observe full live tree representing the full prototype chain:', 'color:deepskyblue');
        console.log('<top.root>', root);
        console.log('%cüëÄ Observe the filtered tree as a jsonable object:', 'color:deepskyblue');
        console.log('<top.json>', json);
        console.log('%cüëÄ Observe the filtered tree visually', 'color:deepskyblue');
        console.log(treeify.asTree(json));
        console.log('%cüëÜüèª Begin at the top of the console üëÜüèª', 'color:deepskyblue');
        const element = start;
        element.innerHTML = getButtonInners();
        if (!!JSON.parse(localStorage.full_screen)) element.style.height = '80%';
        element.appendChild(e);
        element.setAttribute('class', 'tf-tree');
        e.innerHTML = e.innerHTML
            .split('function').join('<xxx class="function">function</xxx>');
        const layers = getLayers(element);
        prepareMenu(menu, layers, 6, 30);
        document.querySelectorAll('.tf-nc').forEach(span => {
            const searchParams = new URLSearchParams(window.location.search);
            searchParams.set('filters', span.textContent);
            const url = location.href.split('?')[0] + '?' + searchParams.toString();
            span.innerHTML = `<a class="ofstart" href="${url}">${span.innerHTML}</a>`;
        });
    };
</script>
<script>
    (function(){
        function begin() {
            function isPrimitive(v) {
                if (null === v || undefined === v) {
                    return true;
                }
                if (['boolean', 'number', 'string'].includes(typeof v)) {
                    return true;
                }
                return false;
            }

            // because of adsense
            function isFrame(v) {
                let i = 0;
                let w;
                while (w) {
                    w = top[i];
                    if (v === w) {
                        return true;
                    }
                    i++;
                }
            }

            const root = {};
            const values = {};

            function cb(path) {
                let node = root;
                for (let i = 0; i < path.length; i++) {
                    const val = path[i];
                    const prop = getProp(val);
                    if (!node[prop]) {
                        id += 1;
                        values['b' + id] = val;
                        node[prop] = {
                            _value_reference: 'vf' + id,
                            _own_names: Object.getOwnPropertyNames(val),
                        };
                    }
                    node = node[prop];
                }
            }

            function getProp(val) {
                switch (val) {
                    case Symbol.prototype:
                        return 'Symbol';
                    case Number.prototype:
                        return 'Number';
                    case Array.prototype:
                        return 'Array';
                    case Boolean.prototype:
                        return 'Boolean';
                    case String.prototype:
                        return 'String';
                    default:
                        let v = '';
                        try {
                            if (typeof val === 'symbol') {
                                v = val.toString();
                            } else if (typeof val === 'function') {
                                v = Function.prototype.toString.call(val);
                            } else {
                                v += val;
                            }
                            if ((v).startsWith('data:text/html;Base64,')) {
                                return '[location]';
                            }
                            return v
                                .split('[object ').join('')
                                .split('{ [native code] }').join('')
                                .split(']').join('')
                                .split('\n').join('');
                        } catch (e) {
                            return ({}).toString.call(val).split('[object ').join('').split(']').join('');
                        }
                }
            }

            function main(obj) {
                if (isPrimitive(obj) || isFrame(obj)) return;
                const protos = [obj];
                while (true) {
                    if (isPrimitive(obj) || isFrame(obj)) break;
                    const proto = Object.getPrototypeOf(obj);
                    if (!proto) break;
                    protos.push(proto);
                    obj = proto;
                }
                protos.reverse();
                cb(protos);
            }

            let id = 0;

            (function () {
                const lt = new LavaTube(main, {
                    onShouldIgnoreError: (p, o, e) => {
                        // console.error('sync error in LavaTube:', e);
                        return true;
                    },
                    maxRecursionLimit: 9,
                });
                window.LavaTube = undefined;
                window.begin = undefined;
                lt.walk(window);
                const result = JSON.stringify(root);
                setTimeout(() => {
                    window.values = values;
                    top.postMessage({result}, '*');
                    console.log(`%c${decodeURIComponent(escape(window.atob('8J+Xuu+4jw==')))} Map each entry in the full tree below to its real actual object in runtime:`, 'color:deepskyblue');
                    console.log('<generator.contentWindow.values>', values);
                }, 100);
            }());
        }
        document.write(`
<ifram`+`e id="generator" style="display: none" src="data:text/html;Base64,${
            btoa(
                atob('PGh0bWw+PGhlYWQ+PHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vQGxhdmFtb2F0L2xhdmF0dWJlQDAuMi4xL2xhdmF0dWJlLmpzIj48L3NjcmlwdD48L2hlYWQ+PGJvZHk+PHNjcmlwdD4=') +
                begin.toString() + ';' + 'begin();' +
                atob('PC9zY3JpcHQ+PC9ib2R5PjwvaHRtbD4=')
            )
        }"></if`+`rame>
`);
    }())
</script>
</body>
</html>
